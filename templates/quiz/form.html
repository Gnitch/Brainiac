<!DOCTYPE html>
{% load crispy_forms_tags %}
{% include 'quiz/base.html' %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form</title>
</head>
<body>
    {% if type == 'quiz_form' %}
        <h1>Form</h1>
        <form method="POST" >
            {% csrf_token %}
            {{ quiz_form|crispy }}
            <button type="submit">Submit</button>        
        </form>
    {% elif type == 'quiz_view' %}
        <h1>{{quiz_obj.title}}</h1>
        <h3>{{quiz_obj.description}}</h3>
        {% include 'quiz/questionForm.html' %}
        <h2>Add Question</h2>
        <form action="{% url 'quiz:questionFormSubmit' quiz_obj.id %}" method="POST">
            {% csrf_token %}
            {{ question_form|crispy }}
            {{ options_form|crispy }}
            <button type="submit">Submit</button>        
        </form>
    {% endif %}

    <script>

        const user_input = $("#user-input")
        const search_icon = $('#search-icon')
        const artists_div = $('#replaceable-content')
        const endpoint = '/blogs/search_community/'
        const delay_by_in_ms = 50
        let scheduled_function = false

        let ajax_call = function (endpoint, request_parameters) {
            $.getJSON(endpoint, request_parameters)
                .done(response => {
                    // fade out the artists_div, then:
                    // artists_div.fadeTo('slow', 0).promise().then(() => {
                        // replace the HTML contents
                        artists_div.html(response['html_from_view'])
                        // fade-in the div with new contents
                        // artists_div.fadeTo('slow', 1)
                        // stop animating search icon
                        search_icon.removeClass('blink')
                    // })
                })
        }


        user_input.on('keyup', function () {
            const request_parameters = {
                q: $(this).val() // value of user_input: the HTML element with ID user-input
            }

            // start animating the search icon with the CSS class
            search_icon.addClass('blink')

            // if scheduled_function is NOT false, cancel the execution of the function
            if (scheduled_function) {
                clearTimeout(scheduled_function)
            }

            // setTimeout returns the ID of the function to be executed
            scheduled_function = setTimeout(ajax_call, delay_by_in_ms, endpoint, request_parameters)
        })

    </script>

</body>
</html>